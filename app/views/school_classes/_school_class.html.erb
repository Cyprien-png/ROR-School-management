<div id="<%= dom_id school_class %>">
  <p>
    <strong>Name:</strong>
    <%= school_class.name %>
  </p>

  <p>
    <strong>Grade:</strong>
    <%= school_class.grade %>
  </p>

  <p>
    <strong>Academic Year:</strong>
    <%= "#{school_class.year.first_trimester.start_date.year}-#{school_class.year.fourth_trimester.end_date.year}" %>
  </p>

  <p>
    <strong>Teacher:</strong>
    <%= "#{school_class.teacher.firstname} #{school_class.teacher.lastname}" %>
  </p>

  <div class="students-list">
    <div class="students-header">
      <h3>Students in this class:</h3>
      <% if current_person.is_a?(Dean) %>
        <div class="add-student-form">
          <%= form_with(url: add_student_school_class_path(school_class), method: :post, class: "inline-form") do |f| %>
            <%= f.collection_select :student_id, 
                Student.where.not(id: school_class.student_ids), 
                :id, 
                ->(s) { "#{s.lastname} #{s.firstname}" }, 
                { prompt: "Select a student to add" } %>
            <%= f.submit "Add Student", class: "button" %>
          <% end %>
        </div>
      <% end %>
    </div>

    <% if school_class.students.any? %>
      <table class="students-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Status</th>
            <% if current_person.is_a?(Dean) %>
              <th>Actions</th>
            <% end %>
          </tr>
        </thead>
        <tbody>
          <% school_class.students.each do |student| %>
            <tr>
              <td><%= "#{student.lastname} #{student.firstname}" %></td>
              <td><%= student.email %></td>
              <td><%= student.status %></td>
              <% if current_person.is_a?(Dean) %>
                <td>
                  <%= button_to "Remove", 
                      remove_student_school_class_path(school_class, student_id: student.id),
                      method: :delete,
                      class: "button delete",
                      form: { class: "inline-form" } %>
                </td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p>No students in this class yet.</p>
    <% end %>
  </div>
</div>
